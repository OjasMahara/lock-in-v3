<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<title>LockIn_Tab v3</title>
<link rel="icon" type="image/png" href="icon.png">
<link rel="manifest" href="manifest.json">
<link rel="apple-touch-icon" href="icon.png">
<meta name="theme-color" content="#1f2937">
<style>
:root{
  --bg:#111827; /* Darker background for a more native feel */
  --card:#1f2937; --muted:#94a3b8; --accent:#22c55e;
  --accent-glow:0 0 15px rgba(34,197,94,.4);
  --glass:rgba(255,255,255,.05); --border:rgba(255,255,255,.08);
  --focus-blue:#60a5fa; --warning:#f97316; --success:#34d399;
}

html, body {
  height: 100%;
  margin: 0;
  font-family: Inter, system-ui, sans-serif;
  color: #f8fafc;
  background: var(--bg);
  /* CRITICAL: Disables pull-to-refresh so you don't lose your timer */
  overscroll-behavior-y: none; 
}

body { display: flex; justify-content: center; align-items: flex-start; }

.app {
  max-width: 800px;
  width: 92%;
  margin: 20px auto;
  padding: 20px;
  border-radius: 16px;
  background: var(--card);
  position: relative;
  box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}

header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
h1 { margin: 0; font-size: 22px; color: var(--accent); }

/* Mobile-friendly inputs: 16px font prevents iOS "Jump-Zoom" */
input, button {
  font-size: 16px; 
  padding: 14px;
  border-radius: 10px;
  border: 1px solid var(--border);
  background: #111827;
  color: inherit;
  /* Removes tap lag on mobile */
  touch-action: manipulation; 
}

.task-input { display: flex; gap: 10px; margin-bottom: 24px; }
.task-input input[type=text] { flex: 1; }
.task-input input[type=number] { width: 70px; }

.task-list { display: grid; gap: 12px; }
.task {
  padding: 16px;
  border-radius: 12px;
  border: 1px solid var(--border);
  background: #111827;
  display: flex;
  justify-content: space-between;
  align-items: center;
  /* Removes the ugly grey tap box on mobile */
  -webkit-tap-highlight-color: transparent; 
}

.timer-grid { display: none; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 25px; }
.timer-card { background: var(--glass); padding: 15px; border-radius: 14px; border: 1px solid var(--border); text-align: center; }
.time { font-size: 36px; font-weight: 700; font-variant-numeric: tabular-nums; }

.actions { display: flex; gap: 12px; margin-top: 20px; }
.actions button { flex: 1; padding: 18px; font-size: 18px; }

button.primary { background: var(--accent); border: none; color: #000; font-weight: 700; }
button.secondary { background: #374151; border: none; }

/* --- MOBILE SPECIFIC LAYOUT --- */
@media (max-width: 600px) {
  .app { margin: 10px auto; padding: 15px; }
  h1 { font-size: 18px; }
  .task-input { flex-direction: column; }
  .task-input input[type=number] { width: 100%; box-sizing: border-box; }
  .timer-grid { grid-template-columns: 1fr; }
  .time { font-size: 42px; }
  .task { flex-direction: column; align-items: flex-start; gap: 10px; }
  .task-actions { width: 100%; display: flex; justify-content: flex-end; gap: 8px; }
}

.overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0,0,0,.9); z-index: 1000; }
.overlay-card { background: #111827; padding: 25px; border-radius: 16px; width: 90%; max-height: 85vh; overflow-y: auto; }
</style>

</head>
<body>
<div class="app" id="appContainer">
<header>
<h1>ðŸ”’ Lockâ€‰-In Focus</h1>
<div style="color:var(--muted)">Taskâ€‰-based Time Tracker</div>
</header>
<div class="task-input" id="taskInputBar">
<input id="taskText" type="text" placeholder="Task" />
<input id="estMin" type="number" min="0" placeholder="Min" />
<input id="estSec" type="number" min="0" max="59" placeholder="Sec" />
<button id="addBtn" class="secondary">Add</button>
</div>
<div id="taskList" class="task-list"></div>
<div class="timer-grid">
<div class="timer-card">
<h3>Current Task</h3>
<div id="currentTask">No task selected</div>
<div class="time" id="countdown">00:00</div>
</div>
<div class="timer-card">
<h3>Status</h3>
<div id="stateText">Idle</div>
<div class="time" id="stopwatch">00:00:00</div>
</div>
</div>
<div class="actions">
<button id="startBtn" class="primary">Start</button>
<button id="completeBtn" class="secondary">Complete</button>
</div>
<footer>
<div>Remaining: <span id="remaining">0</span></div>
<div>Done: <span id="doneCount">0</span></div>
</footer>
<div class="footer-credit">by_ojas_mahara</div>
</div>
<div id="resultsOverlay" class="overlay">
<div class="overlay-card" style="max-width:700px;text-align:left">
<h3 style="text-align:center">Session Complete</h3>
<table id="statsTable" style="width:100%;border-collapse:collapse;margin-top:16px;font-size:14px"></table>
<div id="statsSummary" style="margin-top:16px;font-size:14px;white-space:pre-line"></div>
<div style="text-align:center;margin-top:20px">
<button id="closeStatsBtn" class="primary">Start New Session</button>
</div>
</div>
</div>
<script>
let tasks=[],current=null,paused=true,tick=null,taskStart=0,pauseStart=0,totalPaused=0,totalActual=0;
const $=id=>document.getElementById(id);
const fmt=s=>`${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`;
function updateTaskInputVisibility(){
Â  $('taskInputBar').style.display = (!paused && current!==null) ? 'none' : 'flex';
Â  document.querySelector('.timer-grid').style.display = (current !== null) ? 'grid' : 'none';
}
$('addBtn').onclick=()=>{
Â const text=$('taskText').value.trim();
Â if(!text)return;
Â let m=parseInt($('estMin').value||'0',10);
Â let s=parseInt($('estSec').value||'0',10);
Â if(Number.isNaN(m)||Number.isNaN(s))return alert('Invalid time');
Â if(m<0||s<0)return alert('Negative values not allowed');
Â if(s>=60)return alert('Seconds must be below 60');
Â const est=m*60+s;
Â if(est<=0||est>12*60*60)return alert('Time out of range');
Â tasks.push({text,est,spent:0,done:false,alerted:false});
Â $('taskText').value='';$('estMin').value='';$('estSec').value='';
Â render();
};
function render(){
Â const list=$('taskList');list.innerHTML='';
Â tasks.forEach((t,i)=>{
Â  const d=document.createElement('div');d.className='task';
Â  if(i===current){d.classList.add('selected');if(!t.done)d.classList.add('running');}
Â  if(t.done)d.classList.add('done');
Â  d.innerHTML=`<div>${t.text}</div><div class='meta'>Est ${fmt(t.est)} | Spent ${fmt(t.spent)}</div>`;
Â  if(!t.done && paused){
Â  Â  const actions=document.createElement('div');actions.className='task-actions';
Â  Â  const renameBtn=document.createElement('button');renameBtn.textContent='Rename';
Â  Â  renameBtn.onclick=(e)=>{
Â  Â  Â  e.stopPropagation(); 
Â  Â  Â  if(paused && !t.done){
Â  Â  Â  Â  const newText = prompt('Rename task', t.text);
Â  Â  Â  Â  if(newText !== null && newText.trim() !== ''){
Â  Â  Â  Â  Â  t.text = newText.trim();
Â  Â  Â  Â  Â  render();
Â  Â  Â  Â  }
Â  Â  Â  }
Â  Â  };
Â  Â  const delBtn=document.createElement('button');delBtn.textContent='Delete';
Â  Â  delBtn.onclick=(e)=>{e.stopPropagation(); if(paused){tasks.splice(i,1); if(current===i)current=null; render();}};
Â  Â  actions.appendChild(renameBtn);actions.appendChild(delBtn);
Â  Â  d.appendChild(actions);
Â  }
Â  d.onmousedown=(e)=>{if(paused){dragStart(e,i);}};
Â  d.onclick=()=>{if(!t.done){current=i;loadTask(i);render();}};
Â  list.appendChild(d);
Â });
Â $('remaining').textContent=tasks.filter(t=>!t.done).length;
Â $('doneCount').textContent=tasks.filter(t=>t.done).length;
Â updateTaskInputVisibility();
}
function dragStart(e,index){
Â const dragItem=tasks[index];
Â const onMove=moveEvent=>{
Â  const list=$('taskList');
Â  const y=moveEvent.clientY;
Â  let swapIndex=null;
Â  Array.from(list.children).forEach((child,i)=>{if(i!==index){
Â  Â const rect=child.getBoundingClientRect();
Â  Â if(y>rect.top && y<rect.bottom){swapIndex=i;}
Â  }});
Â  if(swapIndex!==null){tasks.splice(index,1);tasks.splice(swapIndex,0,dragItem);if(current===index)current=swapIndex;render();index=swapIndex;}
Â };
Â const onUp=()=>{document.removeEventListener('mousemove',onMove);document.removeEventListener('mouseup',onUp);};
Â document.addEventListener('mousemove',onMove);
Â document.addEventListener('mouseup',onUp);
}
function loadTask(index){
Â if(current===null || !tasks[index])return;
Â current=index;
Â paused=true;
Â $('currentTask').textContent=tasks[current].text;
Â $('countdown').textContent=fmt(Math.max(0,tasks[current].est-tasks[current].spent));
Â $('stopwatch').textContent=new Date(tasks[current].spent*1000).toISOString().substr(11,8);
Â $('stateText').textContent='Idle';
Â $('startBtn').textContent='Start';
Â updateTaskInputVisibility();
}
$('startBtn').onclick=()=>{
Â if(current===null || !tasks[current])return;
Â if(paused){
Â  paused=false;
Â  if(pauseStart){totalPaused+=Math.floor((Date.now()-pauseStart)/1000);pauseStart=0;}
Â  $('stateText').textContent='Running';$('startBtn').textContent='Pause';
Â  taskStart=Date.now()-tasks[current].spent*1000;
Â  tick && clearInterval(tick);
Â  tick=setInterval(()=>{
Â  Â if(!tasks[current]){clearInterval(tick);return;}
Â  Â const s=Math.floor((Date.now()-taskStart)/1000);
Â  Â tasks[current].spent=s;
Â  Â $('stopwatch').textContent=new Date(s*1000).toISOString().substr(11,8);
Â  Â $('countdown').textContent=fmt(Math.max(0,tasks[current].est-s));
Â  Â if(s>tasks[current].est && !tasks[current].alerted){console.warn('Task exceeded estimated time!');tasks[current].alerted=true;}
Â  Â render();
Â  },1000);
Â }else{
Â  paused=true;pauseStart=Date.now();clearInterval(tick);$('stateText').textContent='Paused';$('startBtn').textContent='Resume';
Â }
Â updateTaskInputVisibility();
};
$('completeBtn').onclick=()=>{
Â if(current===null || !tasks[current])return;
Â clearInterval(tick);paused=true;
Â totalActual+=tasks[current].spent;
Â tasks[current].done=true;
Â const remainingTasks=tasks.filter(t=>!t.done);
Â if(remainingTasks.length>0){
Â  current=tasks.indexOf(remainingTasks[0]);
Â  loadTask(current);
Â } else {
Â  showStats();
Â  current=null;
Â }
Â render();
};
function showStats(){
Â clearInterval(tick);
Â const table=$('statsTable');
Â table.innerHTML='<tr><th>Task</th><th>Estimated</th><th>Actual</th></tr>';
Â let totalEst=0,totalSpent=0;
Â tasks.forEach(t=>{totalEst+=t.est;totalSpent+=t.spent;table.innerHTML+=`<tr><td>${t.text}</td><td>${fmt(t.est)}</td><td>${fmt(t.spent)}</td></tr>`;});
Â const totalFocused = totalActual - totalPaused;
Â const wallClock=totalActual;
Â $('statsSummary').textContent = 
Â `Tasks completed: ${tasks.length}
Total estimated time: ${fmt(totalEst)}
Total actual time spent: ${fmt(totalActual)}
Total focused time (excluding pauses): ${fmt(totalFocused)}
Total paused time: ${fmt(totalPaused)}
Total wall-clock time: ${fmt(wallClock)}`;
Â $('resultsOverlay').style.display='flex';
}
$('closeStatsBtn').onclick=()=>{
Â clearInterval(tick);
Â tasks=[];current=null;paused=true;tick=null;taskStart=0;pauseStart=0;totalPaused=0;totalActual=0;
Â $('taskList').innerHTML='';
Â $('currentTask').textContent='No task selected';
Â $('countdown').textContent='00:00';
Â $('stopwatch').textContent='00:00:00';
Â $('stateText').textContent='Idle';
Â $('startBtn').textContent='Start';
Â $('remaining').textContent='0';
Â $('doneCount').textContent='0';
Â $('resultsOverlay').style.display='none';
Â updateTaskInputVisibility();
};
</script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>

